from Bio import Entrez
from pymed import PubMed
import os
from createdb import *
from createtable import *


Entrez.email = "Your.Name.Here@example.org"
pubmed = PubMed(tool="MyTool", email="my@email.address")

db="Pubmed_research.db"
db_is_new = not os.path.exists(db)
if __name__ == '__main__':
    if db_is_new:
        create_connection(db)
        createtable(db)
        print("\nDatabase and table created!")
    else:
        print('\nThe database and the table already exist!')

from delete import *
deletecontent(db)

print("----------")
sel=input("Insert the term that you want to find: ")
num=input("Insert how many articles do you want to find: ")
results = pubmed.query(sel, max_results=int(num))
print("----------")
id=1
from populatetable import *
for res in results:
    if res.doi!=None:
        d = res.doi.split()
        doi_=d[0]
    else:
        doi_ = None

    if res.pubmed_id != None:
        p = res.pubmed_id.split()
        pid = p[0]
    else:
        pid = None

    if res.abstract=='':
        ab=None
    else:
        ab=res.abstract

    if res.title== '':
        tit=None
    else:
        tit=res.title

        aut = ''
        for i in range(0, len(res.authors)):
            if res.authors[i]['lastname']!=None and res.authors[i]['lastname']!='' and res.authors[i]['firstname']!=None  and res.authors[i]['firstname']!='':
                p1 = res.authors[i]['lastname']
                p2 = res.authors[i]['firstname']
                p = p1 + ' ' + p2
                if i == len(res.authors) - 1:
                    aut = aut + p
                else:
                    aut = aut + p + ', '
        if aut=='':
            aut=None

    print(doi_)
    print(pid)
    print(tit)
    print(res.publication_date)
    print(aut)
    populatetable(db, id, doi_, pid, tit, res.publication_date, aut, ab)
    id+=1
    print("----------")
